<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Visual Lua Code Generator</title>
    <script src="https://unpkg.com/blockly/blockly.min.js"></script>
    <script src="block_definitions.js"></script>
    <script src="lua_generators.js"></script>
  </head>
  <body>
    <h1>Visual Lua Code for ComputerCraft</h1>
    <div id="blocklyDiv" style="height: 480px; width: 100%;"></div>
    <xml id="toolbox" style="display: none">
      <block type="turtle_forward"></block>
      <block type="text_print"></block>
      <block type="controls_if"></block>
    </xml>
    <button onclick="generateLua()">Export Lua</button>
    <pre id="output"></pre>

    <script>
      const workspace = Blockly.inject('blocklyDiv', {
        toolbox: document.getElementById('toolbox')
      });

      function generateLua() {
        const code = Blockly.Lua.workspaceToCode(workspace);
        document.getElementById('output').textContent = code;

        // download
        const blob = new Blob([code], { type: 'text/plain' });
        const a = document.createElement('a');
        a.download = 'script.lua';
        a.href = URL.createObjectURL(blob);
        a.click();
      }
    </script>
  </body>
</html>
