<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Visual Lua Code Generator</title>
    <script src="https://unpkg.com/blockly/blockly.min.js"></script>
    <script src="block_definitions.js"></script>
    <script src="lua_generators.js"></script>
    <script src="https://unpkg.com/blockly/lua.js"></script> 
  </head>
  <body>
    <h1>Visual Lua Code for ComputerCraft</h1>
    <div id="blocklyDiv" style="height: 480px; width: 100%;"></div>
    <xml id="toolbox" style="display: none">
      <category name="Logic" colour="210">
        <block type="controls_if"></block>
        <block type="logic_compare"></block>
      </category>
      <category name="Loops" colour="120">
        <block type="controls_repeat_ext"></block>
      </category>
      <category name="Math" colour="230">
        <block type="math_number"></block>
        <block type="math_arithmetic"></block>
      </category>
      <category name="Text" colour="160">
        <block type="text_print"></block>
      </category>
      <category name="Variables" colour="330" custom="VARIABLE"></category>
      <category name="Functions" colour="290" custom="PROCEDURE"></category>
      <category name="ComputerCraft" colour="60">
        <block type="turtle_forward"></block>
      </category>
    </xml>
    
    <button onclick="generateLua()">Export Lua</button>
    <pre id="output"></pre>

    <script>
      const workspace = Blockly.inject('blocklyDiv', {
        toolbox: document.getElementById('toolbox')
      });

      function generateLua() {
        const code = Blockly.Lua.workspaceToCode(workspace);
        document.getElementById('output').textContent = code;

        const blob = new Blob([code], { type: 'text/plain' });
        const a = document.createElement('a');
        a.download = 'script.lua';
        a.href = URL.createObjectURL(blob);
        a.click();
      }
    </script>
  </body>
</html>
